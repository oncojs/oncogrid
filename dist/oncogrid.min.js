!function t(e,r,n){function o(a,s){if(!r[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){var r=e[a][1][t];return o(r?r:t)},u,u.exports,t,e,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,r){(function(t){function n(t,e){return t.set(e[0],e[1]),t}function o(t,e){return t.add(e),t}function i(t,e){for(var r=-1,n=t?t.length:0;++r<n&&e(t[r],r,t)!==!1;);return t}function a(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function s(t,e,r,n){var o=-1,i=t?t.length:0;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}function c(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function u(t,e){return null==t?void 0:t[e]}function l(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(r){}return e}function h(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}function d(t,e){return function(r){return t(e(r))}}function p(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}function f(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function g(){this.__data__=Ee?Ee(null):{}}function v(t){return this.has(t)&&delete this.__data__[t]}function m(t){var e=this.__data__;if(Ee){var r=e[t];return r===Gt?void 0:r}return we.call(e,t)?e[t]:void 0}function y(t){var e=this.__data__;return Ee?void 0!==e[t]:we.call(e,t)}function b(t,e){var r=this.__data__;return r[t]=Ee&&void 0===e?Gt:e,this}function x(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function w(){this.__data__=[]}function _(t){var e=this.__data__,r=R(e,t);if(0>r)return!1;var n=e.length-1;return r==n?e.pop():Se.call(e,r,1),!0}function k(t){var e=this.__data__,r=R(e,t);return 0>r?void 0:e[r][1]}function H(t){return R(this.__data__,t)>-1}function T(t,e){var r=this.__data__,n=R(r,t);return 0>n?r.push([t,e]):r[n][1]=e,this}function C(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function O(){this.__data__={hash:new f,map:new(Ie||x),string:new f}}function j(t){return at(this,t)["delete"](t)}function G(t){return at(this,t).get(t)}function S(t){return at(this,t).has(t)}function A(t,e){return at(this,t).set(t,e),this}function L(t){this.__data__=new x(t)}function D(){this.__data__=new x}function F(t){return this.__data__["delete"](t)}function I(t){return this.__data__.get(t)}function M(t){return this.__data__.has(t)}function W(t,e){var r=this.__data__;if(r instanceof x){var n=r.__data__;if(!Ie||n.length<jt-1)return n.push([t,e]),this;r=this.__data__=new C(n)}return r.set(t,e),this}function z(t,e){var r=Xe(t)||yt(t)?c(t.length,String):[],n=r.length,o=!!n;for(var i in t)!e&&!we.call(t,i)||o&&("length"==i||ht(i,n))||r.push(i);return r}function E(t,e,r){var n=t[e];we.call(t,e)&&mt(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function R(t,e){for(var r=t.length;r--;)if(mt(t[r][0],e))return r;return-1}function B(t,e){return t&&nt(e,Tt(e),t)}function P(t,e,r,n,o,a,s){var c;if(n&&(c=a?n(t,o,a,s):n(t)),void 0!==c)return c;if(!kt(t))return t;var u=Xe(t);if(u){if(c=ct(t),!e)return rt(t,c)}else{var h=Ye(t),d=h==Mt||h==Wt;if(Je(t))return Y(t,e);if(h==Rt||h==At||d&&!a){if(l(t))return a?t:{};if(c=ut(d?{}:t),!e)return ot(t,B(c,t))}else{if(!ce[h])return a?t:{};c=lt(t,h,P,e)}}s||(s=new L);var p=s.get(t);if(p)return p;if(s.set(t,c),!u)var f=r?it(t):Tt(t);return i(f||t,function(o,i){f&&(i=o,o=t[i]),E(c,i,P(o,e,r,n,i,t,s))}),c}function N(t){return kt(t)?je(t):{}}function U(t,e,r){var n=e(t);return Xe(t)?n:a(n,r(t))}function $(t){return _e.call(t)}function q(t){if(!kt(t)||pt(t))return!1;var e=wt(t)||l(t)?ke:ae;return e.test(gt(t))}function V(t){if(!ft(t))return De(t);var e=[];for(var r in Object(t))we.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Y(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}function X(t){var e=new t.constructor(t.byteLength);return new Ce(e).set(new Ce(t)),e}function J(t,e){var r=e?X(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function K(t,e,r){var o=e?r(h(t),!0):h(t);return s(o,n,new t.constructor)}function Q(t){var e=new t.constructor(t.source,ie.exec(t));return e.lastIndex=t.lastIndex,e}function Z(t,e,r){var n=e?r(p(t),!0):p(t);return s(n,o,new t.constructor)}function tt(t){return qe?Object(qe.call(t)):{}}function et(t,e){var r=e?X(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function rt(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function nt(t,e,r,n){r||(r={});for(var o=-1,i=e.length;++o<i;){var a=e[o],s=n?n(r[a],t[a],a,r,t):void 0;E(r,a,void 0===s?t[a]:s)}return r}function ot(t,e){return nt(t,Ve(t),e)}function it(t){return U(t,Tt,Ve)}function at(t,e){var r=t.__data__;return dt(e)?r["string"==typeof e?"string":"hash"]:r.map}function st(t,e){var r=u(t,e);return q(r)?r:void 0}function ct(t){var e=t.length,r=t.constructor(e);return e&&"string"==typeof t[0]&&we.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function ut(t){return"function"!=typeof t.constructor||ft(t)?{}:N(Oe(t))}function lt(t,e,r,n){var o=t.constructor;switch(e){case Vt:return X(t);case Dt:case Ft:return new o(+t);case Yt:return J(t,n);case Xt:case Jt:case Kt:case Qt:case Zt:case te:case ee:case re:case ne:return et(t,n);case zt:return K(t,n,r);case Et:case Ut:return new o(t);case Pt:return Q(t);case Nt:return Z(t,n,r);case $t:return tt(t)}}function ht(t,e){return e=null==e?St:e,!!e&&("number"==typeof t||se.test(t))&&t>-1&&t%1==0&&e>t}function dt(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function pt(t){return!!be&&be in t}function ft(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||me;return t===r}function gt(t){if(null!=t){try{return xe.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function vt(t){return P(t,!0,!0)}function mt(t,e){return t===e||t!==t&&e!==e}function yt(t){return xt(t)&&we.call(t,"callee")&&(!Ge.call(t,"callee")||_e.call(t)==At)}function bt(t){return null!=t&&_t(t.length)&&!wt(t)}function xt(t){return Ht(t)&&bt(t)}function wt(t){var e=kt(t)?_e.call(t):"";return e==Mt||e==Wt}function _t(t){return"number"==typeof t&&t>-1&&t%1==0&&St>=t}function kt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Ht(t){return!!t&&"object"==typeof t}function Tt(t){return bt(t)?z(t):V(t)}function Ct(){return[]}function Ot(){return!1}var jt=200,Gt="__lodash_hash_undefined__",St=9007199254740991,At="[object Arguments]",Lt="[object Array]",Dt="[object Boolean]",Ft="[object Date]",It="[object Error]",Mt="[object Function]",Wt="[object GeneratorFunction]",zt="[object Map]",Et="[object Number]",Rt="[object Object]",Bt="[object Promise]",Pt="[object RegExp]",Nt="[object Set]",Ut="[object String]",$t="[object Symbol]",qt="[object WeakMap]",Vt="[object ArrayBuffer]",Yt="[object DataView]",Xt="[object Float32Array]",Jt="[object Float64Array]",Kt="[object Int8Array]",Qt="[object Int16Array]",Zt="[object Int32Array]",te="[object Uint8Array]",ee="[object Uint8ClampedArray]",re="[object Uint16Array]",ne="[object Uint32Array]",oe=/[\\^$.*+?()[\]{}|]/g,ie=/\w*$/,ae=/^\[object .+?Constructor\]$/,se=/^(?:0|[1-9]\d*)$/,ce={};ce[At]=ce[Lt]=ce[Vt]=ce[Yt]=ce[Dt]=ce[Ft]=ce[Xt]=ce[Jt]=ce[Kt]=ce[Qt]=ce[Zt]=ce[zt]=ce[Et]=ce[Rt]=ce[Pt]=ce[Nt]=ce[Ut]=ce[$t]=ce[te]=ce[ee]=ce[re]=ce[ne]=!0,ce[It]=ce[Mt]=ce[qt]=!1;var ue="object"==typeof t&&t&&t.Object===Object&&t,le="object"==typeof self&&self&&self.Object===Object&&self,he=ue||le||Function("return this")(),de="object"==typeof r&&r&&!r.nodeType&&r,pe=de&&"object"==typeof e&&e&&!e.nodeType&&e,fe=pe&&pe.exports===de,ge=Array.prototype,ve=Function.prototype,me=Object.prototype,ye=he["__core-js_shared__"],be=function(){var t=/[^.]+$/.exec(ye&&ye.keys&&ye.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),xe=ve.toString,we=me.hasOwnProperty,_e=me.toString,ke=RegExp("^"+xe.call(we).replace(oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),He=fe?he.Buffer:void 0,Te=he.Symbol,Ce=he.Uint8Array,Oe=d(Object.getPrototypeOf,Object),je=Object.create,Ge=me.propertyIsEnumerable,Se=ge.splice,Ae=Object.getOwnPropertySymbols,Le=He?He.isBuffer:void 0,De=d(Object.keys,Object),Fe=st(he,"DataView"),Ie=st(he,"Map"),Me=st(he,"Promise"),We=st(he,"Set"),ze=st(he,"WeakMap"),Ee=st(Object,"create"),Re=gt(Fe),Be=gt(Ie),Pe=gt(Me),Ne=gt(We),Ue=gt(ze),$e=Te?Te.prototype:void 0,qe=$e?$e.valueOf:void 0;f.prototype.clear=g,f.prototype["delete"]=v,f.prototype.get=m,f.prototype.has=y,f.prototype.set=b,x.prototype.clear=w,x.prototype["delete"]=_,x.prototype.get=k,x.prototype.has=H,x.prototype.set=T,C.prototype.clear=O,C.prototype["delete"]=j,C.prototype.get=G,C.prototype.has=S,C.prototype.set=A,L.prototype.clear=D,L.prototype["delete"]=F,L.prototype.get=I,L.prototype.has=M,L.prototype.set=W;var Ve=Ae?d(Ae,Object):Ct,Ye=$;(Fe&&Ye(new Fe(new ArrayBuffer(1)))!=Yt||Ie&&Ye(new Ie)!=zt||Me&&Ye(Me.resolve())!=Bt||We&&Ye(new We)!=Nt||ze&&Ye(new ze)!=qt)&&(Ye=function(t){var e=_e.call(t),r=e==Rt?t.constructor:void 0,n=r?gt(r):void 0;if(n)switch(n){case Re:return Yt;case Be:return zt;case Pe:return Bt;case Ne:return Nt;case Ue:return qt}return e});var Xe=Array.isArray,Je=Le||Ot;e.exports=vt}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,r){(function(t){function r(t,e){var r=t?t.length:0;return!!r&&i(t,e,0)>-1}function n(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function o(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}function i(t,e,r){if(e!==e)return o(t,a,r);for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}function a(t){return t!==t}function s(t,e){return t.has(e)}function c(t,e){return null==t?void 0:t[e]}function u(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(r){}return e}function l(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}function h(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function d(){this.__data__=pt?pt(null):{}}function p(t){return this.has(t)&&delete this.__data__[t]}function f(t){var e=this.__data__;if(pt){var r=e[t];return r===q?void 0:r}return st.call(e,t)?e[t]:void 0}function g(t){var e=this.__data__;return pt?void 0!==e[t]:st.call(e,t)}function v(t,e){var r=this.__data__;return r[t]=pt&&void 0===e?q:e,this}function m(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function y(){this.__data__=[]}function b(t){var e=this.__data__,r=L(e,t);if(0>r)return!1;var n=e.length-1;return r==n?e.pop():lt.call(e,r,1),!0}function x(t){var e=this.__data__,r=L(e,t);return 0>r?void 0:e[r][1]}function w(t){return L(this.__data__,t)>-1}function _(t,e){var r=this.__data__,n=L(r,t);return 0>n?r.push([t,e]):r[n][1]=e,this}function k(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function H(){this.__data__={hash:new h,map:new(ht||m),string:new h}}function T(t){return I(this,t)["delete"](t)}function C(t){return I(this,t).get(t)}function O(t){return I(this,t).has(t)}function j(t,e){return I(this,t).set(t,e),this}function G(t){var e=-1,r=t?t.length:0;for(this.__data__=new k;++e<r;)this.add(t[e])}function S(t){return this.__data__.set(t,q),this}function A(t){return this.__data__.has(t)}function L(t,e){for(var r=t.length;r--;)if(B(t[r][0],e))return r;return-1}function D(t){if(!N(t)||z(t))return!1;var e=P(t)||u(t)?ut:K;return e.test(E(t))}function F(t,e,o){var i=-1,a=r,c=t.length,u=!0,h=[],d=h;if(o)u=!1,a=n;else if(c>=$){var p=e?null:ft(t);if(p)return l(p);u=!1,a=s,d=new G}else d=e?[]:h;t:for(;++i<c;){var f=t[i],g=e?e(f):f;if(f=o||0!==f?f:0,u&&g===g){for(var v=d.length;v--;)if(d[v]===g)continue t;e&&d.push(g),h.push(f)}else a(d,g,o)||(d!==h&&d.push(g),h.push(f))}return h}function I(t,e){var r=t.__data__;return W(e)?r["string"==typeof e?"string":"hash"]:r.map}function M(t,e){var r=c(t,e);return D(r)?r:void 0}function W(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function z(t){return!!it&&it in t}function E(t){if(null!=t){try{return at.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function R(t){return t&&t.length?F(t):[]}function B(t,e){return t===e||t!==t&&e!==e}function P(t){var e=N(t)?ct.call(t):"";return e==Y||e==X}function N(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function U(){}var $=200,q="__lodash_hash_undefined__",V=1/0,Y="[object Function]",X="[object GeneratorFunction]",J=/[\\^$.*+?()[\]{}|]/g,K=/^\[object .+?Constructor\]$/,Q="object"==typeof t&&t&&t.Object===Object&&t,Z="object"==typeof self&&self&&self.Object===Object&&self,tt=Q||Z||Function("return this")(),et=Array.prototype,rt=Function.prototype,nt=Object.prototype,ot=tt["__core-js_shared__"],it=function(){var t=/[^.]+$/.exec(ot&&ot.keys&&ot.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),at=rt.toString,st=nt.hasOwnProperty,ct=nt.toString,ut=RegExp("^"+at.call(st).replace(J,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lt=et.splice,ht=M(tt,"Map"),dt=M(tt,"Set"),pt=M(Object,"create");h.prototype.clear=d,h.prototype["delete"]=p,h.prototype.get=f,h.prototype.has=g,h.prototype.set=v,m.prototype.clear=y,m.prototype["delete"]=b,m.prototype.get=x,m.prototype.has=w,m.prototype.set=_,k.prototype.clear=H,k.prototype["delete"]=T,k.prototype.get=C,k.prototype.has=O,k.prototype.set=j,G.prototype.add=G.prototype.push=S,G.prototype.has=A;var ft=dt&&1/l(new dt([,-0]))[1]==V?function(t){return new dt(t)}:U;e.exports=R}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e,r){!function(t,e){"object"==typeof r&&r&&"string"!=typeof r.nodeName?e(r):"function"==typeof define&&define.amd?define(["exports"],e):(t.Mustache={},e(t.Mustache))}(this,function(t){function e(t){return"function"==typeof t}function r(t){return g(t)?"array":typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}function i(t,e){return v.call(t,e)}function a(t){return!i(m,t)}function s(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return y[t]})}function c(e,r){function o(){if(m&&!y)for(;v.length;)delete f[v.pop()];else v=[];m=!1,y=!1}function i(t){if("string"==typeof t&&(t=t.split(x,2)),!g(t)||2!==t.length)throw new Error("Invalid tags: "+t);s=new RegExp(n(t[0])+"\\s*"),c=new RegExp("\\s*"+n(t[1])),d=new RegExp("\\s*"+n("}"+t[1]))}if(!e)return[];var s,c,d,p=[],f=[],v=[],m=!1,y=!1;i(r||t.tags);for(var H,T,C,O,j,G,S=new h(e);!S.eos();){if(H=S.pos,C=S.scanUntil(s))for(var A=0,L=C.length;L>A;++A)O=C.charAt(A),a(O)?v.push(f.length):y=!0,f.push(["text",O,H,H+1]),H+=1,"\n"===O&&o();if(!S.scan(s))break;if(m=!0,T=S.scan(k)||"name",S.scan(b),"="===T?(C=S.scanUntil(w),S.scan(w),S.scanUntil(c)):"{"===T?(C=S.scanUntil(d),S.scan(_),S.scanUntil(c),T="&"):C=S.scanUntil(c),!S.scan(c))throw new Error("Unclosed tag at "+S.pos);if(j=[T,C,H,S.pos],f.push(j),"#"===T||"^"===T)p.push(j);else if("/"===T){if(G=p.pop(),!G)throw new Error('Unopened section "'+C+'" at '+H);if(G[1]!==C)throw new Error('Unclosed section "'+G[1]+'" at '+H)}else"name"===T||"{"===T||"&"===T?y=!0:"="===T&&i(C)}if(G=p.pop())throw new Error('Unclosed section "'+G[1]+'" at '+S.pos);return l(u(f))}function u(t){for(var e,r,n=[],o=0,i=t.length;i>o;++o)e=t[o],e&&("text"===e[0]&&r&&"text"===r[0]?(r[1]+=e[1],r[3]=e[3]):(n.push(e),r=e));return n}function l(t){for(var e,r,n=[],o=n,i=[],a=0,s=t.length;s>a;++a)switch(e=t[a],e[0]){case"#":case"^":o.push(e),i.push(e),o=e[4]=[];break;case"/":r=i.pop(),r[5]=e[2],o=i.length>0?i[i.length-1][4]:n;break;default:o.push(e)}return n}function h(t){this.string=t,this.tail=t,this.pos=0}function d(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function p(){this.cache={}}var f=Object.prototype.toString,g=Array.isArray||function(t){return"[object Array]"===f.call(t)},v=RegExp.prototype.test,m=/\S/,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},b=/\s*/,x=/\s+/,w=/\s*=/,_=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var r=e[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},h.prototype.scanUntil=function(t){var e,r=this.tail.search(t);switch(r){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=e.length,e},d.prototype.push=function(t){return new d(t,this)},d.prototype.lookup=function(t){var r,n=this.cache;if(n.hasOwnProperty(t))r=n[t];else{for(var i,a,s=this,c=!1;s;){if(t.indexOf(".")>0)for(r=s.view,i=t.split("."),a=0;null!=r&&a<i.length;)a===i.length-1&&(c=o(r,i[a])),r=r[i[a++]];else r=s.view[t],c=o(s.view,t);if(c)break;s=s.parent}n[t]=r}return e(r)&&(r=r.call(this.view)),r},p.prototype.clearCache=function(){this.cache={}},p.prototype.parse=function(t,e){var r=this.cache,n=r[t];return null==n&&(n=r[t]=c(t,e)),n},p.prototype.render=function(t,e,r){var n=this.parse(t),o=e instanceof d?e:new d(e);return this.renderTokens(n,o,r,t)},p.prototype.renderTokens=function(t,e,r,n){for(var o,i,a,s="",c=0,u=t.length;u>c;++c)a=void 0,o=t[c],i=o[0],"#"===i?a=this.renderSection(o,e,r,n):"^"===i?a=this.renderInverted(o,e,r,n):">"===i?a=this.renderPartial(o,e,r,n):"&"===i?a=this.unescapedValue(o,e):"name"===i?a=this.escapedValue(o,e):"text"===i&&(a=this.rawValue(o)),void 0!==a&&(s+=a);return s},p.prototype.renderSection=function(t,r,n,o){function i(t){return a.render(t,r,n)}var a=this,s="",c=r.lookup(t[1]);if(c){if(g(c))for(var u=0,l=c.length;l>u;++u)s+=this.renderTokens(t[4],r.push(c[u]),n,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)s+=this.renderTokens(t[4],r.push(c),n,o);else if(e(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");c=c.call(r.view,o.slice(t[3],t[5]),i),null!=c&&(s+=c)}else s+=this.renderTokens(t[4],r,n,o);return s}},p.prototype.renderInverted=function(t,e,r,n){var o=e.lookup(t[1]);return!o||g(o)&&0===o.length?this.renderTokens(t[4],e,r,n):void 0},p.prototype.renderPartial=function(t,r,n){if(n){var o=e(n)?n(t[1]):n[t[1]];return null!=o?this.renderTokens(this.parse(o),r,n,o):void 0}},p.prototype.unescapedValue=function(t,e){var r=e.lookup(t[1]);return null!=r?r:void 0},p.prototype.escapedValue=function(e,r){var n=r.lookup(e[1]);return null!=n?t.escape(n):void 0},p.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.2.1",t.tags=["{{","}}"];var H=new p;t.clearCache=function(){return H.clearCache()},t.parse=function(t,e){return H.parse(t,e)},t.render=function(t,e,n){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+r(t)+'" was given as the first argument for mustache#render(template, view, partials)');return H.render(t,e,n)},t.to_html=function(r,n,o,i){var a=t.render(r,n,o);return e(i)?void i(a):a},t.escape=s,t.Scanner=h,t.Context=d,t.Writer=p})},{}],4:[function(t,e,r){"use strict";var n;n=function(t,e,r){var n=this,o=t.histogramBorderPadding||{};n.lineWidthOffset=o.left||10,n.lineHeightOffset=o.bottom||5,n.padding=20,n.centerText=-6,n.prefix=t.prefix||"og-",n.observations=t.observations,n.svg=e,n.rotated=r||!1,n.domain=(n.rotated?t.genes:t.donors)||[],n.margin=t.margin||{top:30,right:15,bottom:15,left:80},n.clickFunc=n.rotated?t.geneHistogramClick:t.donorHistogramClick,n.width=t.width||500,n.height=t.height||500,n.histogramWidth=n.rotated?n.height:n.width,n.histogramHeight=80,n.numDomain=n.domain.length,n.barWidth=(n.rotated?n.height:n.width)/n.domain.length,n.totalHeight=n.histogramHeight+n.lineHeightOffset+n.padding},n.prototype.render=function(t,e){function r(){for(var t=1,e=0;e<n.domain.length;e++){var r=n.domain[e];t=Math.max(t,r.count)}return t}var n=this;n.x=t,n.div=e;var o=r();n.container=n.svg.append("g").attr("class",n.prefix+"histogram").attr("width",function(){return n.rotated?n.height:n.width+n.margin.left+n.margin.right}).attr("height",n.histogramHeight).style("margin-left",n.margin.left+"px").attr("transform",function(){return n.rotated?"rotate(90)translate(0,-"+n.width+")":""}),n.histogram=n.container.append("g").attr("transform","translate(0,-"+(n.totalHeight+n.centerText)+")"),n.renderAxis(o),n.histogram.selectAll("rect").data(n.domain).enter().append("rect").on("mouseover",function(t){n.div.transition().duration(200).style("opacity",.9),n.div.html(function(){return n.rotated?t.symbol+"<br/> Count:"+t.count+"<br/>":t.id+"<br/> Count:"+t.count+"<br/>"}).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){n.div.transition().duration(500).style("opacity",0)}).on("click",n.clickFunc).attr("class",function(t){return n.prefix+"sortable-bar "+n.prefix+t.id+"-bar"}).attr("width",n.barWidth-(n.barWidth<3?0:1)).attr("height",function(t){return n.histogramHeight*t.count/o}).attr("x",function(t){return n.x(n.getIndex(n.domain,t.id))}).attr("y",function(t){return n.histogramHeight-n.histogramHeight*t.count/o}).attr("fill","#1693C0")},n.prototype.update=function(t,e){var r=this;r.x=e,r.domain=t,r.barWidth=(r.rotated?r.height:r.width)/r.domain.length,r.histogram.selectAll("rect").transition().attr("width",r.barWidth-(r.barWidth<3?0:1)).attr("x",function(t){return r.x(r.getIndex(r.domain,t.id))})},n.prototype.resize=function(t,e){var r=this;r.width=t,r.height=e,r.histogramWidth=r.rotated?r.height:r.width,r.container.attr("width",function(){return r.rotated?r.height:r.width+r.margin.left+r.margin.right}).attr("transform",function(){return r.rotated?"rotate(90)translate(0,-"+r.width+")":""}),r.histogram.attr("transform","translate(0,-"+(r.totalHeight+r.centerText)+")"),r.bottomAxis.attr("x2",r.histogramWidth+10)},n.prototype.renderAxis=function(t){var e=this;e.bottomAxis=e.histogram.append("line").attr("class",e.prefix+"histogram-axis").attr("y1",e.histogramHeight+e.lineHeightOffset).attr("y2",e.histogramHeight+e.lineHeightOffset).attr("x2",e.histogramWidth+e.lineWidthOffset).attr("transform","translate(-"+e.lineHeightOffset+",0)"),e.histogram.append("line").attr("class",e.prefix+"histogram-axis").attr("y1",0).attr("y2",e.histogramHeight+e.lineHeightOffset).attr("transform","translate(-"+e.lineHeightOffset+",0)"),e.histogram.append("text").attr("class",e.prefix+"label-text-font").attr("x",e.centerText).attr("dy",".32em").attr("text-anchor","end").text(t);var r=parseInt(t/2),n=e.histogramHeight-e.histogramHeight/(t/r);e.histogram.append("text").attr("class",e.prefix+"label-text-font").attr("x",e.centerText).attr("y",n).attr("dy",".32em").attr("text-anchor","end").text(r);var o=e.histogram.append("text").attr("class",e.prefix+"label-text-font").attr("dy",".32em").attr("text-anchor","end").text("Mutation freq.");o.each(function(){var t=this.getBBox().width;o.attr("transform","rotate(-90)translate("+-(e.histogramHeight-t)+","+-(e.lineHeightOffset+e.padding)+")")})},n.prototype.getIndex=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.id===e)return r}return-1},n.prototype.destroy=function(){var t=this;t.histogram.remove(),t.container.remove()},e.exports=n},{}],5:[function(t,e,r){"use strict";var n,o=t("mustache"),i=t("./Histogram"),a=t("./Track");n=function(t,e,r,n){var o=this;o.lookupTable=e,o.updateCallback=r,o.resizeCallback=n,o.loadParams(t),o.init(),o.donorHistogram=new i(t,o.container,!1),o.histogramHeight=o.donorHistogram.totalHeight,o.donorTrack=new a(t,o.container,!1,t.donorTracks,t.donorOpacityFunc,t.donorFillFunc,r,o.height,o.resizeCallback),o.donorTrack.init(),o.geneHistogram=new i(t,o.container,!0),o.geneTrack=new a(t,o.container,!0,t.geneTracks,t.geneOpacityFunc,t.geneFillFunc,r,o.width+o.histogramHeight,o.resizeCallback),o.geneTrack.init()},n.prototype.loadParams=function(t){var e=this;e.scaleToFit="boolean"==typeof t.scaleToFit?t.scaleToFit:!0,e.leftTextWidth=t.leftTextWidth||80,e.prefix=t.prefix||"og-",e.minCellHeight=t.minCellHeight||10,e.donors=t.donors||[],e.genes=t.genes||[],e.observations=t.observations||[],e.element=t.element||"body",e.colorMap=t.colorMap||{missense_variant:"#ff9b6c",frameshift_variant:"#57dba4",stop_gained:"#af57db",start_lost:"#ff2323",stop_lost:"#d3ec00",initiator_codon_variant:"#5abaff"},e.numDonors=e.donors.length,e.numGenes=e.genes.length,e.width=t.width||500,e.height=t.height||500,e.inputWidth=t.width||500,e.inputHeight=t.height||500,e.cellWidth=e.width/e.donors.length,e.cellHeight=e.height/e.genes.length,e.cellHeight<e.minCellHeight&&(e.cellHeight=e.minCellHeight,t.height=e.numGenes*e.minCellHeight,e.height=t.height),e.margin=t.margin||{top:30,right:100,bottom:15,left:80},e.heatMap=t.heatMap,e.drawGridLines=t.grid||!1,e.crosshair=!1,e.gridClick=t.gridClick;var r=t.templates||{};e.templates={mainGrid:r.mainGrid||"{{#observation}}{{observation.id}}<br>{{observation.geneSymbol}}<br>{{observation.donorId}}<br>{{observation.consequence}}<br>{{/observation}}",mainGridCrosshair:r.mainGridCrosshair||"{{#donor}}Donor: {{donor.id}}<br>{{/donor}}{{#gene}}Gene: {{gene.symbol}}<br>{{/gene}}"}},n.prototype.init=function(){var t=this;t.div=d3.select(t.element).append("div").attr("class",t.prefix+"tooltip-oncogrid").style("opacity",0),t.svg=d3.select(t.element).append("svg").attr("class",t.prefix+"maingrid-svg").attr("id",t.prefix+"maingrid-svg").attr("width","100%"),t.container=t.svg.append("g"),t.background=t.container.append("rect").attr("class","background").attr("width",t.width).attr("height",t.height)},n.prototype.render=function(){var t=this;t.computeCoordinates(),t.container.selectAll("."+t.prefix+"maingrid-svg").data(t.observations).enter().append("rect").on("mouseover",function(e){var r=d3.mouse(this),n=t.rangeToDomain(t.x,r[0]),i=t.rangeToDomain(t.y,r[1]),a=t.crosshair?t.templates.mainGridCrosshair:t.templates.mainGrid,s=o.render(a||"",{observation:e,donor:t.donors[n],gene:t.genes[i]});s&&(t.div.transition().duration(200).style("opacity",.9),t.div.html(s).style("left",d3.event.pageX+15+"px").style("top",d3.event.pageY+30+"px"))}).on("mouseout",function(){t.div.transition().duration(500).style("opacity",0)}).on("click",function(e){"undefined"!=typeof t.gridClick&&t.gridClick(e)}).attr("class",function(e){return t.prefix+"sortable-rect "+t.prefix+e.donorId+"-cell "+t.prefix+e.geneId+"-cell"}).attr("cons",function(t){return t.consequence}).attr("x",function(e){return t.x(t.getDonorIndex(t.donors,e.donorId))}).attr("y",function(e){return t.getY(e)}).attr("width",t.cellWidth).attr("height",function(e){return t.getHeight(e)}).attr("fill",function(e){return t.getColor(e)}).attr("opacity",function(e){return t.getOpacity(e)}).attr("stroke-width",2),t.donorHistogram.render(t.x,t.div),t.donorTrack.render(t.x,t.div),t.geneHistogram.render(t.y,t.div),t.geneTrack.render(t.y,t.div),t.defineCrosshairBehaviour(),t.resizeSvg()},n.prototype.update=function(){var t=this;t.numDonors!==t.donors.length||t.numGenes!==t.genes.length?(t.numDonors=t.donors.length,t.numGenes=t.genes.length,t.cellWidth=t.width/t.numDonors,t.cellHeight=t.height/t.numGenes,t.computeCoordinates()):t.row.selectAll("text").attr("style",function(){return t.cellHeight<t.minCellHeight?"display: none;":""}),t.row.transition().attr("transform",function(e){return"translate( 0, "+t.y(t.genes.indexOf(e))+")"}),t.container.selectAll("."+t.prefix+"sortable-rect").transition().attr("width",t.cellWidth).attr("height",function(e){return t.getHeight(e)}).attr("y",function(e){return t.getY(e)}).attr("x",function(e){return t.x(t.getDonorIndex(t.donors,e.donorId))}),t.donorHistogram.update(t.donors,t.x),t.donorTrack.update(t.donors,t.x),t.geneHistogram.update(t.genes,t.y),t.geneTrack.update(t.genes,t.y)},n.prototype.computeCoordinates=function(){var t=this;t.x=d3.scale.ordinal().domain(d3.range(t.donors.length)).rangeBands([0,t.width]),t.cellWidth=t.width/t.donors.length,"undefined"!=typeof t.column&&t.column.remove(),t.column=t.container.selectAll("."+t.prefix+"donor-column").data(t.donors).enter().append("g").attr("class",t.prefix+"donor-column").attr("donor",function(t){return t.id}).attr("transform",function(e,r){return"translate("+t.x(r)+")rotate(-90)"}),t.drawGridLines&&t.column.append("line").attr("x1",-t.height),t.y=d3.scale.ordinal().domain(d3.range(t.genes.length)).rangeBands([0,t.height]),t.cellHeight=t.height/t.genes.length,"undefined"!=typeof t.row&&t.row.remove(),t.row=t.container.selectAll("."+t.prefix+"gene-row").data(t.genes).enter().append("g").attr("class",t.prefix+"gene-row").attr("transform",function(e,r){return"translate(0,"+t.y(r)+")"}),t.drawGridLines&&t.row.append("line").attr("x2",t.width),t.row.append("text").attr("class",function(e){return t.prefix+e.id+"-label "+t.prefix+"gene-label "+t.prefix+"label-text-font"}).attr("x",-8).attr("y",t.cellHeight/2).attr("dy",".32em").attr("text-anchor","end").attr("style",function(){return t.cellHeight<t.minCellHeight?"display: none;":""}).text(function(e,r){return t.genes[r].symbol}),t.defineRowDragBehaviour()},n.prototype.resize=function(t,e){var r=this;r.width=t,r.height=e,r.cellWidth=r.width/r.donors.length,r.cellHeight=r.height/r.genes.length,r.cellHeight<r.minCellHeight&&(r.cellHeight=r.minCellHeight,r.height=r.genes.length*r.minCellHeight),r.background.attr("width",r.width).attr("height",r.height),r.computeCoordinates(),r.donorHistogram.resize(t,r.height),r.donorTrack.resize(t,r.height,r.x,r.height),r.geneHistogram.resize(t,r.height),r.geneTrack.resize(t,r.height,r.y,r.width+r.histogramHeight),r.resizeSvg(),r.update();var n=r.container.node().getBBox();r.verticalCross.attr("y2",n.height),r.horizontalCross.attr("x2",n.width)},n.prototype.resizeSvg=function(){var t=this,e=t.margin.left+t.leftTextWidth+t.width+t.histogramHeight+t.geneTrack.height+t.margin.right,r=t.margin.top+t.histogramHeight+t.height+t.donorTrack.height+t.margin.bottom;t.scaleToFit?t.svg.attr("viewBox","0 0 "+e+" "+r):t.svg.attr("width",e).attr("height",r),t.container.attr("transform","translate("+(t.margin.left+t.leftTextWidth)+","+(t.margin.top+t.histogramHeight)+")")},n.prototype.defineCrosshairBehaviour=function(){var t=this,e=function(e,r){if(t.crosshair){var n=d3.mouse(r);t.verticalCross.attr("x1",n[0]).attr("opacity",1),t.verticalCross.attr("x2",n[0]).attr("opacity",1),t.horizontalCross.attr("y1",n[1]).attr("opacity",1),t.horizontalCross.attr("y2",n[1]).attr("opacity",1),"mousemove"===e&&"undefined"!=typeof t.selectionRegion&&t.changeSelection(n)}};t.verticalCross=t.container.append("line").attr("class",t.prefix+"vertical-cross").attr("y1",-t.histogramHeight).attr("y2",t.height+t.donorTrack.height).attr("opacity",0).attr("style","pointer-events: none"),t.horizontalCross=t.container.append("line").attr("class",t.prefix+"horizontal-cross").attr("x1",0).attr("x2",t.width+t.histogramHeight+t.geneTrack.height).attr("opacity",0).attr("style","pointer-events: none"),t.container.on("mousedown",function(){t.startSelection(this)}).on("mouseover",function(){e("mouseover",this)}).on("mousemove",function(){e("mousemove",this)}).on("mouseout",function(){t.crosshair&&(t.verticalCross.attr("opacity",0),t.horizontalCross.attr("opacity",0))}).on("mouseup",function(){t.finishSelection()})},n.prototype.startSelection=function(t){var e=this;if(e.crosshair&&"undefined"==typeof e.selectionRegion){d3.event.stopPropagation();var r=d3.mouse(t);e.selectionRegion=e.container.append("rect").attr("x",r[0]).attr("y",r[1]).attr("width",1).attr("height",1).attr("class",e.prefix+"selection-region").attr("stroke","black").attr("stroke-width","2").attr("opacity",.2)}},n.prototype.changeSelection=function(t){var e=this,r={x:parseInt(e.selectionRegion.attr("x"),10),y:parseInt(e.selectionRegion.attr("y"),10),width:parseInt(e.selectionRegion.attr("width"),10),
height:parseInt(e.selectionRegion.attr("height"),10)},n={x:t[0]-Number(e.selectionRegion.attr("x")),y:t[1]-Number(e.selectionRegion.attr("y"))};n.x<1||2*n.x<r.width?(r.x=t[0],r.width-=n.x):r.width=n.x,n.y<1||2*n.y<r.height?(r.y=t[1],r.height-=n.y):r.height=n.y,e.selectionRegion.attr(r)},n.prototype.finishSelection=function(){var t=this;if(t.crosshair&&"undefined"!=typeof t.selectionRegion){d3.event.stopPropagation();var e=Number(t.selectionRegion.attr("x")),r=e+Number(t.selectionRegion.attr("width")),n=Number(t.selectionRegion.attr("y")),o=n+Number(t.selectionRegion.attr("height")),i=t.rangeToDomain(t.x,e),a=t.rangeToDomain(t.x,r),s=t.rangeToDomain(t.y,n),c=t.rangeToDomain(t.y,o);t.sliceDonors(i,a),t.sliceGenes(s,c),t.selectionRegion.remove(),delete t.selectionRegion,t.fullscreen||t.resize(t.inputWidth,t.inputHeight),t.updateCallback(!0)}},n.prototype.sliceGenes=function(t,e){for(var r=this,n=0;n<r.genes.length;n++){var o=r.genes[n];(t>n||n>e)&&(d3.selectAll("."+r.prefix+o.id+"-cell").remove(),d3.selectAll("."+r.prefix+o.id+"-bar").remove(),r.genes.splice(n,1),n--,t--,e--)}},n.prototype.sliceDonors=function(t,e){for(var r=this,n=0;n<r.donors.length;n++){var o=r.donors[n];(t>n||n>e)&&(d3.selectAll("."+r.prefix+o.id+"-cell").remove(),d3.selectAll("."+r.prefix+o.id+"-bar").remove(),r.donors.splice(n,1),n--,t--,e--)}},n.prototype.defineRowDragBehaviour=function(){var t=this,e=d3.behavior.drag();e.on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),e.on("drag",function(){var t=d3.event.dy,e=d3.select(this);e.attr("transform",function(){var e=d3.transform(d3.select(this).attr("transform"));return"translate( 0, "+(parseInt(e.translate[1])+t)+")"})}),e.on("dragend",function(e){var r=d3.mouse(t.container.node()),n=t.genes.indexOf(e),o=t.rangeToDomain(t.y,r[1]);t.genes.splice(n,1),t.genes.splice(o,0,e),t.updateCallback(!0)});var r=t.row.call(e);r.on("click",function(){d3.event.defaultPrevented}),t.row.on("mouseover",function(){var e=this;"undefined"!=typeof e.timeout&&clearTimeout(e.timeout),d3.select(this).select("."+t.prefix+"remove-gene").attr("style","display: block")}),t.row.on("mouseout",function(){var e=this;e.timeout=setTimeout(function(){d3.select(e).select("."+t.prefix+"remove-gene").attr("style","display: none")},500)})},n.prototype.getY=function(t){var e=this,r=e.genes.map(function(t){return t.id});if(e.heatMap===!0)return e.y(r.indexOf(t.geneId));var n=e.lookupTable[t.donorId][t.geneId];return e.y(r.indexOf(t.geneId))+e.cellHeight/n.length*n.indexOf(t.id)},n.prototype.getColor=function(t){var e=this;return e.heatMap===!0?"#D33682":e.colorMap[t.consequence]},n.prototype.getOpacity=function(){var t=this;return t.heatMap===!0?.25:1},n.prototype.getHeight=function(t){var e=this;if("undefined"!=typeof t){if(e.heatMap===!0)return e.cellHeight;var r=e.lookupTable[t.donorId][t.geneId].length;return e.cellHeight/r}return 0},n.prototype.toggleHeatmap=function(){var t=this;return t.heatMap=t.heatMap!==!0,d3.selectAll("."+t.prefix+"sortable-rect").transition().attr("y",function(e){return t.getY(e)}).attr("height",function(e){return t.getHeight(e)}).attr("fill",function(e){return t.getColor(e)}).attr("opacity",function(e){return t.getOpacity(e)}),t.heatMap},n.prototype.toggleGridLines=function(){var t=this;return t.drawGridLines=!t.drawGridLines,t.geneTrack.toggleGridLines(),t.donorTrack.toggleGridLines(),t.computeCoordinates(),t.drawGridLines},n.prototype.toggleCrosshair=function(){var t=this;return t.crosshair=!t.crosshair,t.crosshair},n.prototype.getDonorIndex=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.id===e)return r}return-1},n.prototype.removeGene=function(t){var e=this,r=e.genes[t];r&&(d3.selectAll("."+e.prefix+r.id+"-cell").remove(),d3.selectAll("."+e.prefix+r.id+"-bar").remove(),e.genes.splice(t,1)),e.updateCallback(!0)},n.prototype.rangeToDomain=function(t,e){return t.domain()[d3.bisect(t.range(),e)-1]},n.prototype.destroy=function(){var t=this;d3.select(t.element).select("."+t.prefix+"maingrid-svg").remove(),d3.select(t.element).select("."+t.prefix+"tooltip-oncogrid").remove()},e.exports=n},{"./Histogram":4,"./Track":7,mustache:3}],6:[function(t,e,r){"use strict";var n,o=t("lodash.clonedeep"),i=t("./MainGrid");n=function(t){var e=this;e.params=t,e.donors=t.donors||[],e.genes=t.genes||[],e.observations=t.observations||[],e.inputWidth=t.width||500,e.inputHeight=t.height||500,e.createLookupTable(),e.computeDonorCounts(),e.computeGeneCounts(),e.computeGeneScores(),e.genesSortbyScores(),e.computeScores(),e.sortByScores(),e.initCharts()},n.prototype.initCharts=function(){var t=this;t.mainGrid=new i(o(t.params),t.lookupTable,t.update(t),function(){t.resize(t.inputWidth,t.inputHeight,t.fullscreen)}),t.heatMapMode=t.mainGrid.heatMap,t.drawGridLines=t.mainGrid.drawGridLines,t.crosshairMode=t.mainGrid.crosshair,t.charts=[],t.charts.push(t.mainGrid)},n.prototype.createLookupTable=function(){for(var t=this,e={},r=0;r<t.observations.length;r++){var n=t.observations[r],o=n.donorId,i=n.geneId;e.hasOwnProperty(o)?e[o].hasOwnProperty(i)?e[o][i].push(n.id):e[o][i]=[n.id]:(e[o]={},e[o][i]=[n.id]),t.lookupTable=e}},n.prototype.render=function(){var t=this;setTimeout(function(){t.charts.forEach(function(t){t.render()})})},n.prototype.update=function(t){var e=t;return function(t){t="undefined"==typeof t||null===t?!1:t,t&&(e.computeScores(),e.sortByScores()),e.charts.forEach(function(t){t.update()})}},n.prototype.resize=function(t,e,r){var n=this;n.fullscreen=r,n.charts.forEach(function(n){n.fullscreen=r,n.resize(Number(t),Number(e))})},n.prototype.sortByScores=function(){var t=this;t.donors.sort(t.sortScore)},n.prototype.genesSortbyScores=function(){var t=this;t.genes.sort(t.sortScore)},n.prototype.getDonorIndex=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.id===e)return r}return-1},n.prototype.cluster=function(){var t=this;t.genesSortbyScores(),t.computeScores(),t.sortByScores(),t.update(t)()},n.prototype.removeDonors=function(t){for(var e=this,r=[],n=0;n<e.donors.length;n++){var o=e.donors[n];t(o)&&(r.push(o.id),d3.selectAll("."+e.prefix+o.id+"-cell").remove(),d3.selectAll("."+e.prefix+o.id+"-bar").remove(),e.donors.splice(n,1),n--)}for(var i=0;i<e.observations.length;i++){var a=e.observations[i];e.donors.indexOf(a.id)>=0&&(e.observations.splice(i,1),i--)}e.computeGeneScores(),e.update(e)(),e.resize(e.inputWidth,e.inputHeight,!1)},n.prototype.removeGenes=function(t){for(var e=this,r=[],n=0;n<e.genes.length;n++){var o=e.genes[n];t(o)&&(r.push(o.id),d3.selectAll("."+e.prefix+o.id+"-cell").remove(),d3.selectAll("."+e.prefix+o.id+"-bar").remove(),e.genes.splice(n,1),n--)}e.update(e)(),e.resize(e.inputWidth,e.inputHeight,!1)},n.prototype.sortDonors=function(t){var e=this;e.donors.sort(t),e.update(e)()},n.prototype.sortGenes=function(t){var e=this;e.computeScores(),e.sortByScores(),e.genes.sort(t),e.update(e)()},n.prototype.toggleHeatmap=function(){var t=this;t.heatMapMode=t.mainGrid.toggleHeatmap()},n.prototype.toggleGridLines=function(){var t=this;t.drawGridLines=t.mainGrid.toggleGridLines()},n.prototype.toggleCrosshair=function(){var t=this;t.crosshairMode=t.mainGrid.toggleCrosshair()},n.prototype.mutationScore=function(t,e){var r=this;return r.lookupTable.hasOwnProperty(t)&&r.lookupTable[t].hasOwnProperty(e)?1:0},n.prototype.mutationGeneScore=function(t,e){var r=this;return r.lookupTable.hasOwnProperty(t)&&r.lookupTable[t].hasOwnProperty(e)?r.lookupTable[t][e].length:0},n.prototype.computeScores=function(){for(var t=this,e=0;e<t.donors.length;e++){var r=t.donors[e];r.score=0;for(var n=0;n<t.genes.length;n++){var o=t.genes[n];r.score+=t.mutationScore(r.id,o.id)*Math.pow(2,t.genes.length+1-n)}}},n.prototype.computeGeneScores=function(){for(var t=this,e=0;e<t.genes.length;e++){var r=t.genes[e];r.score=0;for(var n=0;n<t.donors.length;n++){var o=t.donors[n];r.score+=t.mutationGeneScore(o.id,r.id)}}},n.prototype.computeDonorCounts=function(){for(var t=this,e=0;e<t.donors.length;e++){var r=t.donors[e];r.count=0;for(var n=0;n<t.observations.length;n++){var o=t.observations[n];r.id===o.donorId&&(r.count+=1)}}},n.prototype.computeGeneCounts=function(){for(var t=this,e=0;e<t.genes.length;e++){var r=t.genes[e];r.count=0;for(var n=0;n<t.observations.length;n++){var o=t.observations[n];r.id===o.geneId&&(r.count+=1)}}},n.prototype.sortScore=function(t,e){return t.score<e.score?1:t.score>e.score?-1:t.id>=e.id?1:-1},n.prototype.destroy=function(){var t=this;t.charts.forEach(function(t){t.destroy()})},n.prototype.reload=function(){var t=this;t.destroy(),t.initCharts(),t.render()},e.exports=n},{"./MainGrid":5,"lodash.clonedeep":1}],7:[function(t,e,r){"use strict";var n,o=t("./TrackGroup");n=function(t,e,r,n,o,i,a,s,c){var u=this;u.padding=20,u.offset=s,u.params=t,u.prefix=t.prefix||"og-",u.svg=e,u.rotated=r||!1,u.updateCallback=a,u.resizeCallback=c,u.expandableGroups=t.expandableGroups||[],u.addTrackFunc=t.addTrackFunc,u.trackLegends=t.trackLegends||{},u.trackLegendLabel=t.trackLegendLabel,u.clickFunc=u.rotated?t.geneClick:t.donorClick,u.margin=t.margin||{top:30,right:15,bottom:15,left:80},u.domain=(u.rotated?t.genes:t.donors)||[],u.width=(u.rotated?t.height:t.width)||500,u.cellHeight=t.trackHeight||10,u.numDomain=u.domain.length,u.cellWidth=u.width/u.numDomain,u.availableTracks=n||[],u.opacityFunc=o,u.fillFunc=i,u.drawGridLines=t.grid||!1,u.nullSentinel=t.nullSentinel||-777,u.parseGroups()},n.prototype.parseGroups=function(){var t=this;t.groupMap={},t.groups=[],t.availableTracks.forEach(function(e){var r=e.group||"Tracks";if(t.groupMap.hasOwnProperty(r))t.groupMap[r].addTrack(e);else{var n=new o({cellHeight:t.cellHeight,width:t.width,clickFunc:t.clickFunc,grid:t.drawGridLines,nullSentinel:t.nullSentinel,domain:t.domain,trackLegend:t.trackLegends[r]||"",trackLegendLabel:t.trackLegendLabel,expandable:t.expandableGroups.indexOf(r)>=0,addTrackFunc:t.addTrackFunc},r,t.rotated,t.opacityFunc,t.fillFunc,t.updateCallback,t.resizeCallback);n.addTrack(e),t.groupMap[r]=n,t.groups.push(n)}})},n.prototype.init=function(){var t=this;t.container=t.svg.append("g");var e=0;t.height=0;for(var r=0;r<t.groups.length;r++){var n=t.groups[r],o=t.container.append("g").attr("transform","translate(0,"+t.height+")");n.init(o),t.height+=Number(n.totalHeight)+t.padding,t.rotated&&n.label.each(function(){e=Math.max(e,this.getBBox().height)})}var i=t.rotated?-(t.offset+t.height):t.padding+t.offset;t.container.attr("width",t.width).attr("height",t.height).attr("class",t.prefix+"track").attr("transform",function(){return(t.rotated?"rotate(90)":"")+"translate(0,"+i+")"}),t.height+=e},n.prototype.render=function(t,e){for(var r=this,n=0;n<r.groups.length;n++){var o=r.groups[n];o.render(t,e)}},n.prototype.resize=function(t,e,r,n){var o=this;o.offset=n||o.offset,o.width=o.rotated?e:t,o.height=0;for(var i=0,a=0;a<o.groups.length;a++){var s=o.groups[a];s.container.attr("transform","translate(0,"+o.height+")"),s.resize(o.width,r),o.height+=Number(s.totalHeight)+o.padding,o.rotated&&s.label.each(function(){i=Math.max(i,this.getBBox().height)})}var c=o.rotated?-(o.offset+o.height):o.padding+o.offset;o.container.attr("width",o.width).attr("height",o.height).attr("transform",function(){return(o.rotated?"rotate(90)":"")+"translate(0,"+c+")"}),o.height+=i},n.prototype.update=function(t,e){var r=this;r.domain=t,r.x=e;for(var n=0;n<r.groups.length;n++){var o=r.groups[n];o.update(t,e)}},n.prototype.toggleGridLines=function(){for(var t=this,e=0;e<t.groups.length;e++){var r=t.groups[e];r.toggleGridLines()}},e.exports=n},{"./TrackGroup":8}],8:[function(t,e,r){"use strict";var n,o=t("lodash.uniq");n=function(t,e,r,n,o,i,a){var s=this;s.prefix=t.prefix||"og-",s.expandable=t.expandable,s.name=e,s.cellHeight=t.cellHeight||20,s.height=0,s.totalHeight=0,s.width=t.width,s.tracks=[],s.collapsedTracks=[],s.length=0,s.nullSentinel=t.nullSentinel||-777,s.rotated=r,s.updateCallback=i,s.resizeCallback=a,s.trackLegend=t.trackLegend,s.trackLegendLabel=t.trackLegendLabel,s.clickFunc=t.clickFunc,s.opacityFunc=n,s.fillFunc=o,s.addTrackFunc=t.addTrackFunc||function(t,e){e(t[0])},s.drawGridLines=t.grid||!1,s.domain=t.domain,s.numDomain=s.domain.length,s.trackData=[]},n.prototype.addTrack=function(t){var e=this;t=Array.isArray(t)?t:[t];for(var r,n=0;n<t.length;n++)r=t[n],!e.rendered&&r.collapsed&&e.expandable?e.collapsedTracks.push(r):e.tracks.push(r);e.collapsedTracks=e.collapsedTracks.filter(function(t){return!e.tracks.some(function(e){return _.isEqual(t,e)})}),e.tracks=o(e.tracks,"fieldName"),e.length=e.tracks.length,e.height=e.cellHeight*e.length,e.rendered&&(e.refreshData(),e.resizeCallback())},n.prototype.removeTrack=function(t){var e=this,r=e.tracks.splice(t,1);e.collapsedTracks=e.collapsedTracks.concat(r),e.length=e.tracks.length,e.refreshData(),e.resizeCallback()},n.prototype.refreshData=function(){var t=this;t.trackData=[];for(var e,r=0;r<t.domain.length;r++){e=t.domain[r];for(var n,o=0;o<t.length;o++)n=t.tracks[o],t.trackData.push({id:e.id,displayId:t.rotated?e.symbol:e.id,value:e[n.fieldName],displayName:n.name,fieldName:n.fieldName,type:n.type})}},n.prototype.init=function(t){var e=this;e.container=t,e.label=e.container.append("text").attr("x",-6).attr("y",-7).attr("dy",".32em").attr("text-anchor","end").attr("class",e.prefix+"track-group-label").text(e.name),e.legend=e.container.append("text").attr("x",e.width).attr("y",-7).attr("dy",".32em").attr("text-anchor","end").attr("class",e.prefix+"legend-group-label").text(e.trackLegendLabel),e.background=e.container.append("rect").attr("class","background").attr("width",e.width).attr("height",e.height),e.refreshData(),e.totalHeight=e.height+(e.collapsedTracks.length?e.cellHeight:0)},n.prototype.render=function(t,e){var r=this;r.rendered=!0,r.x=t,r.div=e,r.computeCoordinates(),r.cellWidth=r.width/r.domain.length,r.renderData(),r.legend.on("mouseover",function(){r.div.transition().duration(200).style("opacity",.9),r.div.html(function(){return r.trackLegend}).style("left",d3.event.pageX+15+"px").style("top",d3.event.pageY+30+"px")}).on("mouseout",function(){r.div.transition().duration(500).style("opacity",0)})},n.prototype.update=function(t,e){var r=this;r.domain=t,r.x=e,r.domain.length!==r.numDomain&&(r.numDomain=r.domain.length,r.cellWidth=r.width/r.numDomain,r.computeCoordinates()),r.container.selectAll("."+r.prefix+"track-data").transition().attr("x",function(t){return r.getX(t)}).attr("width",r.cellWidth)},n.prototype.resize=function(t,e){var r=this;r.width=t,r.x=e,r.height=r.cellHeight*r.length,r.collapsedTracks.length&&(r.totalHeight=r.height+r.cellHeight),r.cellWidth=r.width/r.domain.length,r.legend.attr("x",r.width),r.background.attr("class","background").attr("width",r.width).attr("height",r.height),r.computeCoordinates(),r.totalHeight=r.height+(r.collapsedTracks.length?r.cellHeight:0),r.renderData()},n.prototype.computeCoordinates=function(){var t=this;t.y=d3.scale.ordinal().domain(d3.range(t.length)).rangeBands([0,t.height]),"undefined"!=typeof t.column&&t.column.remove(),t.column=t.container.selectAll("."+t.prefix+"column").data(t.domain).enter().append("g").attr("class",t.prefix+"column").attr("donor",function(t){return t.id}).attr("transform",function(e,r){return"translate("+t.x(r)+")rotate(-90)"}),t.drawGridLines&&t.column.append("line").attr("x1",-t.height),"undefined"!=typeof t.row&&t.row.remove(),t.row=t.container.selectAll("."+t.prefix+"row").data(t.tracks).enter().append("g").attr("class",t.prefix+"row").attr("transform",function(e,r){return"translate(0,"+t.y(r)+")"}),t.drawGridLines&&t.row.append("line").attr("x2",t.width);var e=t.row.append("text").attr("class",t.prefix+"track-label "+t.prefix+"label-text-font").on("click",function(e){t.domain.sort(e.sort(e.fieldName)),t.updateCallback(!1)}).transition().attr("x",-6).attr("y",t.cellHeight/2).attr("dy",".32em").attr("text-anchor","end").text(function(e,r){return t.tracks[r].name});t.container.selectAll("."+t.prefix+"remove-track").remove(),t.expandable&&setTimeout(function(){var r={};e.each(function(t){r[t.name]=this.getComputedTextLength()}),t.row.append("text").attr("class","remove-track").text("-").attr("y",t.cellHeight/2).attr("dy",".32em").on("click",function(e,r){t.removeTrack(r)}).attr("x",function(t){return-(r[t.name]+12+this.getComputedTextLength())})});var r=t.container.selectAll("."+t.prefix+"add-track");t.collapsedTracks.length&&t.expandable?(r.empty()&&(r=t.container.append("text").text("+").attr("class",""+t.prefix+"add-track").attr("x",-6).attr("dy",".32em").attr("text-anchor","end").on("click",function(){t.addTrackFunc(t.collapsedTracks.slice(),t.addTrack.bind(t))})),r.attr("y",t.cellHeight/2+(t.length&&t.cellHeight+t.y(t.length-1)))):r.remove()},n.prototype.getX=function(t){var e=this,r=e.domain.map(function(t){return t.id});return e.x(r.indexOf(t.id))},n.prototype.getY=function(t){var e=this,r=e.tracks.map(function(t){return t.fieldName});return e.y(r.indexOf(t.fieldName))},n.prototype.toggleGridLines=function(){var t=this;t.drawGridLines=!t.drawGridLines,t.computeCoordinates()},n.prototype.renderData=function(t,e){var r=this,n=r.container.selectAll("."+r.prefix+"track-data").data(r.trackData);n.enter().append("rect"),n.attr("x",function(t){return r.getX(t)}).attr("y",function(t){return r.getY(t)}).attr("width",r.cellWidth).attr("height",r.cellHeight).attr("fill",r.fillFunc).attr("opacity",r.opacityFunc).attr("class",function(t){return r.prefix+"track-data "+r.prefix+"track-"+t.fieldName+" "+r.prefix+"track-"+t.value+" "+r.prefix+t.id+"-cell"}).on("click",function(t){r.clickFunc(t)}).on("mouseover",function(t){r.div.transition().duration(200).style("opacity",.9),r.div.html(function(){return r.rotated?t.displayId+"<br>"+t.displayName+": "+(t.value===r.nullSentinel?"Not Verified":t.value):t.id+"<br>"+t.displayName+": "+(t.value===r.nullSentinel?"Not Verified":t.value)}).style("left",d3.event.pageX+15+"px").style("top",d3.event.pageY+30+"px")}).on("mouseout",function(){r.div.transition().duration(500).style("opacity",0)}),n.exit().remove()},e.exports=n},{"lodash.uniq":2}],9:[function(t,e,r){"use strict";window.OncoGrid=t("./OncoGrid")},{"./OncoGrid":6}]},{},[9]);